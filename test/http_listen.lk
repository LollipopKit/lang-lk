shy headers = {}
headers.__str = fn(a) {
    shy s = ''
    for k, v in a {
        s = s .. k .. ': ' .. v .. '\n'
    }
    rt s
}

shy fn handle(req) {
    setmetatable(req.headers, headers)
    rt 200, fmt('%s %s\n\n%s\n%s', req.method, req.url, req.headers, req.body)
}

if http.listen(':8080', handle) != nil {
    error(err)
}